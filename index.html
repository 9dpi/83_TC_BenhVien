<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>83 Tiêu chí BYT - Portal Vũ Quang Cường</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --bg: #030712;
            --card: #0f172a;
            --primary: #3b82f6;
        }

        body {
            background: var(--bg);
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            margin: 0;
        }

        header {
            height: 75px;
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 1px solid #1e293b;
            display: flex;
            align-items: center;
            padding: 0 40px;
            z-index: 1000;
            position: relative;
            justify-content: space-between;
            backdrop-filter: blur(10px);
        }

        /* Mega Menu Centered */
        .mega-nav {
            display: flex;
            gap: 10px;
            height: 100%;
            align-items: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .nav-item {
            position: relative;
            height: 100%;
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0 15px;
            font-size: 11px;
            font-weight: 800;
            color: #94a3b8;
            transition: 0.3s;
        }

        .nav-item:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .mega-content {
            position: fixed;
            top: 75px;
            left: 0;
            width: 100vw;
            background: #0f172a;
            border-bottom: 3px solid var(--primary);
            display: none;
            grid-template-columns: repeat(5, 1fr);
            padding: 35px;
            gap: 25px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.9);
            z-index: 999;
            max-height: 80vh;
            overflow-y: auto;
        }

        .nav-item:hover .mega-content {
            display: grid;
        }

        .mega-chapter h4 {
            font-size: 10px;
            color: var(--primary);
            margin-bottom: 12px;
            border-bottom: 1px solid #1e293b;
            padding-bottom: 6px;
            text-transform: uppercase;
            font-weight: 900;
        }

        .mega-item {
            font-size: 10px;
            padding: 8px 0;
            color: #64748b;
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
            transition: 0.2s;
            cursor: pointer;
            line-height: 1.5;
        }

        .mega-item:hover {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.08);
            padding-left: 8px;
            border-radius: 4px;
        }

        .main-container {
            display: grid;
            grid-template-columns: 480px 1fr;
            height: calc(100vh - 75px);
        }

        #info-panel {
            background: #0b1120;
            border-right: 1px solid #1e293b;
            padding: 35px;
            overflow-y: auto;
        }

        .hotspot {
            position: absolute;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: 4px solid #fff;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 500;
            animation: pulse-mega 2.5s infinite;
            background: var(--primary);
        }

        @keyframes pulse-mega {
            0% {
                box-shadow: 0 0 0 0px rgba(59, 130, 246, 0.7);
            }

            100% {
                box-shadow: 0 0 0 45px rgba(59, 130, 246, 0);
            }
        }

        .contact-info {
            position: absolute;
            bottom: 35px;
            right: 35px;
            background: rgba(15, 23, 42, 0.9);
            padding: 15px 25px;
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.4);
            backdrop-filter: blur(12px);
            z-index: 800;
        }
    </style>
</head>

<body>
    <header>
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center font-black">83</div>
            <div>
                <h1 class="text-xs font-black uppercase leading-none text-white">Chất lượng Bệnh viện</h1>
                <p class="text-[9px] text-blue-500 font-bold uppercase tracking-widest mt-1">Vũ Quang Cường Portal</p>
            </div>
        </div>
        <nav class="mega-nav" id="mega-nav-container"></nav>
        <div class="text-right">
            <p class="text-[8px] opacity-40 font-black uppercase">AVG Hệ thống</p>
            <div class="flex items-center gap-3">
                <span id="total-avg" class="text-xl font-black text-blue-500">0.00</span>
                <div class="w-16 h-1.5 bg-slate-800 rounded-full overflow-hidden">
                    <div id="energy-fill" class="h-full bg-blue-500 w-0 transition-all duration-1000"></div>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside id="info-panel">
            <div id="welcome" class="text-center py-48 opacity-10"><i class="fas fa-database text-8xl mb-6"></i>
                <p class="text-[11px] font-black uppercase tracking-widest">Đang kết nối dữ liệu...</p>
            </div>
            <div id="appendix-view" class="hidden">
                <div id="appendix-content"></div>
            </div>
        </aside>
        <main id="hospital-frame">
            <div id="layout-wrapper" class="relative">
                <img src="./images/layout_Tang1.png" id="hospital-map" class="max-h-[82vh] object-contain">
                <div id="hotspot-container"></div>
            </div>
            <div class="contact-info">
                <p class="text-[9px] text-blue-500 font-black uppercase tracking-widest mb-1">Chuyên gia Quản lý Chất
                    lượng</p>
                <p class="text-[14px] font-black text-white">Vũ Quang Cường</p>
                <p class="text-[11px] text-slate-400 font-semibold"><i
                        class="fas fa-phone-alt mr-2 text-blue-500"></i>0912.580.018</p>
            </div>
        </main>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby38k-cbBIZv4M0NVa29lWzKpeDzHavkFdbuJ3i0wJhNh0rS6cPh6k_UqOGB9_ImzoD/exec";
        let masterData = {};

        async function init() {
            try {
                const res = await fetch(API_URL);
                masterData = await res.json();
                renderDashboard();
                renderMegaMenu();
                renderHotspots();
            } catch (e) { document.getElementById('welcome').innerHTML = "Lỗi nạp dữ liệu!"; }
        }

        function renderMegaMenu() {
            const nav = document.getElementById('mega-nav-container');
            const sections = [
                { id: 'A', name: 'NGƯỜI BỆNH', icon: 'fa-user-injured' },
                { id: 'B', name: 'NHÂN LỰC', icon: 'fa-id-card-alt' },
                { id: 'C', name: 'CHUYÊN MÔN', icon: 'fa-hospital-user' },
                { id: 'D', name: 'CẢI TIẾN', icon: 'fa-chart-pie' },
                { id: 'E', name: 'ĐẶC THÙ', icon: 'fa-hand-holding-heart' }
            ];

            nav.innerHTML = sections.map(sec => `
                <div class="nav-item">
                    <i class="fas ${sec.icon} mr-2 text-blue-500"></i> PHẦN ${sec.id}
                    <div class="mega-content" id="mega-${sec.id}"></div>
                </div>
            `).join('');

            // Tự động phân loại tiêu chí vào Mega Menu
            for (let room in masterData) {
                masterData[room].standards.forEach(s => {
                    const secChar = s.section.charAt(5);
                    const megaBox = document.getElementById(`mega-${secChar}`);
                    if (!megaBox) return;

                    let chapDiv = megaBox.querySelector(`[data-chap="${s.chapter}"]`);
                    if (!chapDiv) {
                        chapDiv = document.createElement('div');
                        chapDiv.className = 'mega-chapter';
                        chapDiv.setAttribute('data-chap', s.chapter);
                        chapDiv.innerHTML = `<h4>${s.chapter}</h4><div class="item-list"></div>`;
                        megaBox.appendChild(chapDiv);
                    }

                    const item = document.createElement('div');
                    item.className = 'mega-item';
                    item.innerHTML = `<b>${s.code}</b>: ${s.name}`;
                    item.onclick = (e) => { e.stopPropagation(); selectCriterion(room, s.code); };
                    chapDiv.querySelector('.item-list').appendChild(item);
                });
            }
        }

        function renderDashboard() {
            let total = 0, count = 0;
            for (let k in masterData) { total += parseFloat(masterData[k].stats.avg); count++; }
            const avg = (total / count || 0).toFixed(2);
            document.getElementById('total-avg').innerText = avg;
            document.getElementById('energy-fill').style.width = (avg / 5 * 100) + "%";
        }

        function renderHotspots() {
            const container = document.getElementById('hotspot-container');
            container.innerHTML = "";
            for (let id in masterData) {
                const room = masterData[id];
                const dot = document.createElement('div');
                dot.className = 'hotspot';
                dot.style.left = room.posX + "%"; dot.style.top = room.posY + "%";
                dot.onclick = () => selectCriterion(id, room.standards[0].code);
                container.appendChild(dot);
            }
        }

        function selectCriterion(roomId, code) {
            const s = masterData[roomId].standards.find(st => st.code === code);
            document.getElementById('welcome').classList.add('hidden');
            document.getElementById('appendix-view').classList.remove('hidden');
            document.getElementById('appendix-content').innerHTML = `
                <div class="bg-blue-600/20 p-5 rounded-2xl mb-8 border border-blue-500/30">
                    <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-1">Phiếu đánh giá chuẩn</p>
                    <h2 class="text-3xl font-black text-white">TIÊU CHÍ ${s.code}</h2>
                </div>
                <h3 class="text-white font-black text-[15px] mb-8 uppercase leading-tight">${s.name}</h3>
                <div class="space-y-8 text-[12px] leading-relaxed">
                    <div><b class="text-blue-500 uppercase text-[10px] block mb-2 tracking-widest">Thực trạng đánh giá</b><p class="text-slate-200 italic bg-black/40 p-5 rounded-xl border-l-4 border-blue-600">${s.desc || 'N/A'}</p></div>
                    <div><b class="text-blue-500 uppercase text-[10px] block mb-2 tracking-widest">Giải trình xếp mức</b><p class="text-slate-400">${s.reason || 'N/A'}</p></div>
                </div>
            `;
        }
        window.onload = init;
    </script>
</body>

</html>